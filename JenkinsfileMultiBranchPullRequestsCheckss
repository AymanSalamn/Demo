pipeline {
    agent any

    environment {
        GITHUB_TOKEN = credentials('github-token-id') // Replace with your Jenkins credential ID
    }

    stages {
        stage('Test') {
            steps {
                // Your test steps here
                echo 'Testing...'
            }
        }
    }

    post {
        success {
            script {
                updateGithubPRStatus("success", "Build successful")
            }
        }
        failure {
            script {
                updateGithubPRStatus("failure", "Build failed")
            }
        }
    }
}

def updateGithubPRStatus(String state, String description) {
    def repo = 'AymanSalamn/Demo' // e.g., "user/repo"
    def prNumber = env.CHANGE_ID // Jenkins environment variable for PR number
    def sha = env.GIT_COMMIT // Jenkins environment variable for the commit SHA

    def url = "https://api.github.com/repos/${repo}/statuses/${sha}"

    def payload = [
        state: state,
        description:description,
        context:"Jenkins CI"
    ]

    sh """
        curl -s -X POST -H "Authorization: token ${GITHUB_TOKEN}" \
        -H "Content-Type: application/json" \
        -d '${groovy.json.JsonOutput.toJson(payload)}' \
        ${url}
    """
}
