

pipeline {
    agent any

    environment {
        CHANGED_FILES = """add/file1.txt
                            tests/ams/files/test_file2.js
                            not/config.yaml
                            notaddong/test_file3.py"""
    }

    stages { 
        stage('Test') {
            when {
                expression {
                    // Split the CHANGED_FILES environment variable into a list of files
                    def files = env.CHANGED_FILES.split('\n')
                    // Check if any file contains the 'test' keyword
                    def testFiles = files.findAll { it.contains("test") }
                    // Only proceed with the stage if there are test files
                    echo "testFiles: ${testFiles}"
                    return !testFiles.isEmpty()
                }
            }
            steps {
                echo 'Running tests...'
            }
        }
        
        stage('Deploy') {
            steps {
                echo 'Deploying...'
            }
        }
    }
}
