pipeline {
    agent any

    environment {
        PYTEST_COMMAND = "${params.pytestCommand}"
        REPORT_DIR_NAME = "${params.resultsDirName}"
        REPORT_DIR_NAME_HTML = "${params.resultsDirName}_html"
        AWS_ACCESS_KEY_ID = credentials('aws_access_key')
        AWS_SECRET_ACCESS_KEY = credentials('aws_secret_key')
        AWS_S3_BUCKET = "pytest-allure-report-results"
    }   
    stages {
        stage('Run Test') {
            steps {
                script {
                    sh "/var/lib/jenkins/.local/bin/${env.PYTEST_COMMAND} --alluredir=${env.REPORT_DIR_NAME}"
                }
            }
        }
    }
    
    // Add post-build actions if necessary
    post {
        always {
            // Always clean the workspace regardless of the build result
            deleteDir()
        }
    }
}
