

pipeline {
    agent any

    environment {
        CHANGED_FILES = """file1.txt
                            test_file2.js
                            config.yaml
                            test_file3.py"""
    }

    stages {
        stage('Build') {
            steps {
                echo 'Building...'
            }
        }
        
        stage('Test') {
            when {
                expression {
                    // Split the CHANGED_FILES environment variable into a list of files
                    def files = env.CHANGED_FILES.split('\n')
                    // Check if any file contains the 'test' keyword
                    def testFiles = files.findAll { it.contains("test") }
                    // Only proceed with the stage if there are test files
                    return !testFiles.isEmpty()
                }
            }
            steps {
                echo 'Running tests...'
            }
        }
        
        stage('Deploy') {
            steps {
                echo 'Deploying...'
            }
        }
    }
}
