pipeline {
    agent any

    environment {
        BASE_SHA = "${env.CHANGE_TARGET}"  // Assuming CHANGE_TARGET is set by Jenkins (e.g., from SCM or user input)
        CURRENT_SHA = env.GIT_COMMIT      // Assuming GIT_COMMIT is set by Jenkins
    }

    stages {
        stage('Get Affected Files') {
            steps {
                script {
                    // Get the list of affected files
                    def affectedFiles = sh(script: "git diff --name-only ${env.BASE_SHA} ${env.CURRENT_SHA}", returnStdout: true).trim().split('\n')
                    
                    // Print the list of affected files
                    echo "Affected files in this pull request:"
                    affectedFiles.each { file ->
                        echo file
                    }

                    // Optionally, save the list to an environment variable or file
                    env.AFFECTED_FILES = affectedFiles.join(",")
                }
            }
        }
    }
}
