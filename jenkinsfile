pipeline {
    agent any
    def paytest_command = params.pytestCommand
    def report_results_dir = params.resultsDirName


    stages {
        stage('Install Allure') {
            steps {
                script {
                    def currentDir = pwd()
                    sh 'wget -q -nv https://github.com/allure-framework/allure2/releases/download/2.27.0/allure-2.27.0.tgz'
                    sh 'tar -zxf allure-2.27.0.tgz'
                    def allure_dir="${currentDir}/allure-2.27.0"
                }
            }
        }

        stage('Run Test') {
            steps {
                script {
                    sh "${paytest_command} --alluredir=${report_results_dir}"
                }
            }
        
        }
        
    }
}
